key = true;

while(key)
{
    swap(lock, key)
}
# critical section
lock = false
